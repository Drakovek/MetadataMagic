# Configuration

Configuration files for *Metadata-Magic* are stored in JSON format.
A default config file can be found at [metadata-magic.json](./metadata-magic.json)

## JSON Reader Options

The purpose of the JSON reader is read JSON metadata from a wide variety of different formats, and extract common bits of metadata for use in Metadata-Magic. The options for extracting these values are stored in the     `json_reader` key in the configuration file.

Each metadata field has an object in the greater `json_reader` object, which then has a field `keys` which contains an array specifying where to look in various JSON metadata files to get this particular metadata field. an example for finding the title in metadata might look as follows:

    "title": {
        "keys": [
            ["title"]
            ["info", "title"]
        ]
    }

In this example, Metadata-Magic will first look for a `title` key in the source JSON to find the title info. If that fails, it will move to the second potential location, which will be a `info` key with a nested `title` key.

Most metadata fields follow this basic format. These fields are `id`, `title` `artists`, `writers`, `description`, and `num`.

Some metadata fields require additional information, which is detailed below.

### Tags

The `tags` field mostly follows the basic `json_reader` structure, except tag info is gathered from ALL of the keys listed, not just the first key that has a valid field in the source JSON. Also there is an additional `internal_keys` field. Here is an example `tags` object:

    "tags": {
        "keys": [
            ["info", "web_tags"],
            ["tags"],
            ["categories"]
        ],
        "internal_keys": [
            ["translated_name"],
            ["name"]
        ]
    }

The `internal_keys` list is used for tags which are not given as a simple list of strings in the source JSON, but as a list of objects. If any of the lists gathered by the standard `keys` field are lists of objects instead of strings, it will use the `internal_keys` field to find the strings within each object to add to the tag list.

### Publisher

Most source JSON metadata files do not include a field for the publisher, so instead the publisher is derived by searching for patterns within other included fields, usually the media URL. Here is an example of a `publisher` object.

    "publisher": {
        "keys": [
            ["link"],
            ["url"],
            ["category"]
        ],
        "match": [
            {"match":"^deviantart$|^.+\\.deviantart\\.com.*$", "publisher":"DeviantArt"},
            {"match":"^pixiv$|^.+\\.pximg\\.net.*$", "publisher":"Pixiv"},
        ]
    }

The `keys` array gives the fields to check in the source JSON to attempt deriving a publisher from, while the `match` array gives a list of regex patterns to check for in the metadata fields retrieved from the `keys` fields. Each object in the `match` list contains a `match` field, which contains a regex pattern that the retrieved field must match exactly (case-insensitive), and a `publisher` field, which is the name of the publisher to use if the field is a match.

### URL

The `url` field mostly fits the basic `json_reader` structure, but contains an additional `patterns` object for source JSON files that do not contain a full URL for the media. Here is an example of a `url` object:

    "url": {
        "keys": [
            ["link"],
            ["url"],
            ["web", "page_url"]
        ],
        "patterns": {
            "Fur Affinity": "https://www.furaffinity.net/view/{id}",
        }
    }

For most source JSONs the URL will simply be fetched from the `keys` array as normal. However, some source JSONs do not have a field containing a direct link to the referenced media, and in those cases, the URL must be derived from other. If the publisher matches any of the keys in the `patterns` object, the URL will be generated by using the value of the publisher found in the `patterns` object, with items in curly brackets being replaced by the value of the field with that key.
